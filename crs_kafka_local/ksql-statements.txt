CREATE STREAM API_HDB_CPKINFO_AVRO_STREAM WITH (KAFKA_TOPIC='API.HDB.CPKINFO', VALUE_FORMAT='AVRO',PARTITIONS=3, REPLICAS=1);

CREATE STREAM HDB_CPK_INFO_JSON_STREAM WITH (KAFKA_TOPIC='API.HDB.CPKINFO.JSON', VALUE_FORMAT='JSON',PARTITIONS=3, REPLICAS=1) AS SELECT * FROM HDB_CPK_INFO_AVRO_STREAM;

CREATE STREAM API_HDB_CPKAVAILABILITY_AVRO_STREAM WITH (KAFKA_TOPIC='API.HDB.CPKAVAILABILITY', VALUE_FORMAT='AVRO',PARTITIONS=3, REPLICAS=1);

CREATE STREAM API_HDB_CPKAVAILABILITY_JSON_STREAM WITH (KAFKA_TOPIC='API.HDB.CPKAVAILABILITY.JSON', VALUE_FORMAT='JSON',PARTITIONS=3, REPLICAS=1) AS SELECT * FROM API_HDB_CPKAVAILABILITY_AVRO_STREAM;

CREATE STREAM HDB_CPKALL_STREAM WITH(PARTITIONS=3, REPLICAS=1) AS SELECT A.CARPARK_NUMBER AS ROWKEY, A.TOTAL_LOTS AS TOTAL_LOTS, A.LOTS_AVAILABLE AS LOTS_AVAILABLE, B.* FROM API_HDB_CPKAVAILABILITY_AVRO_STREAM A JOIN API_HDB_CPKINFO_AVRO_STREAM B WITHIN 7 DAYS ON A.CARPARK_NUMBER = B.CAR_PARK_NO EMIT CHANGES;