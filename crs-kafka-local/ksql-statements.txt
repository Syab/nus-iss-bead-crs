CREATE STREAM HDB_CPKINFO_STREAM_AVRO (SHORT_TERM_PARKING VARCHAR, CAR_PARK_TYPE VARCHAR, Y_COORD VARCHAR, X_COORD VARCHAR, LATITUDE VARCHAR, LONGITUDE VARCHAR, LATLONG VARCHAR,FREE_PARKING VARCHAR, GANTRY_HEIGHT VARCHAR, CAR_PARK_BASEMENT VARCHAR, NIGHT_PARKING VARCHAR, ADDRESS VARCHAR, CAR_PARK_DECKS VARCHAR, CPKID VARCHAR, CAR_PARK_NO VARCHAR, TYPE_OF_PARKING_SYSTEM VARCHAR) WITH(KAFKA_TOPIC='HDB_CPKINFO', VALUE_FORMAT='avro',PARTITIONS=2, REPLICAS=3);

CREATE STREAM HDB_CPKAVAILABILITY_STREAM_AVRO (API_TIMESTAMP VARCHAR, TOTAL_LOTS VARCHAR, LOT_TYPE VARCHAR, LOTS_AVAILABLE VARCHAR, CARPARK_NUMBER VARCHAR, UPDATE_DATETIME VARCHAR) WITH(KAFKA_TOPIC='HDB_CPKAVAILABILITY', VALUE_FORMAT='avro',PARTITIONS=2, REPLICAS=3);

CREATE STREAM HDB_CPKALL_AVRO_STREAM WITH(KAFKA_TOPIC='HDB_CPKALL', VALUE_FORMAT='AVRO', PARTITIONS=2, REPLICAS=3)
AS SELECT A.CARPARK_NUMBER AS ROWKEY,
   A.API_TIMESTAMP, A.TOTAL_LOTS, A.LOT_TYPE, A.LOTS_AVAILABLE, A.UPDATE_DATETIME,
   B.SHORT_TERM_PARKING AS short_term_parking,
   B.CAR_PARK_TYPE AS carpark_type,
   B.Y_COORD AS y_coord,
   B.X_COORD AS x_coord,
   B.LATITUDE AS latitude,
   B.LONGITUDE AS longitude,
   B.LATLONG AS location,
   B.FREE_PARKING AS free_parking,
   B.GANTRY_HEIGHT AS gantry_height,
   B.CAR_PARK_BASEMENT AS carpark_basement,
   B.NIGHT_PARKING AS night_parking,
   B.ADDRESS AS address,
   B.CAR_PARK_DECKS AS carpark_decks,
   B.CPKID AS carpark_id,
   B.CAR_PARK_NO AS carpark_no,
   B.TYPE_OF_PARKING_SYSTEM AS type_of_parking_system
   FROM HDB_CPKAVAILABILITY_STREAM_AVRO A
      JOIN
      HDB_CPKINFO_STREAM_AVRO B
   WITHIN 7 DAYS GRACE PERIOD 1 HOURS
   ON A.CARPARK_NUMBER = B.CAR_PARK_NO;